# Phase 3.1: Test Plan [PHASE 3.1]

## Subagent Config

- **Type:** general-purpose (single subagent)
- **Input:** `.agents/tmp/kenken/phases/1.2-plan.md`, `.agents/tmp/kenken/phases/2.1-tasks.json`
- **Output:** `.agents/tmp/kenken/phases/3.1-test-plan.md`

## Instructions

Plan what tests to write based on the implementation and project testing instructions.

### Process

1. Read project testing instructions from config (`.claude/kenken-config.json` field `stages.test`)
2. Read implementation plan from `.agents/tmp/kenken/phases/1.2-plan.md`
3. Read completed tasks from `.agents/tmp/kenken/phases/2.1-tasks.json`
4. Auto-detect test framework if not configured (see below)
5. Analyze implementation for testable units
6. Identify test cases: happy path, edge cases, error conditions, boundary values
7. Document test plan following project conventions

### Auto-Detection (when not configured)

If test configuration is not set, detect the framework:

| Indicator | Framework | Test Command |
| --------- | --------- | ------------ |
| `package.json` with jest | Jest | `npx jest` |
| `package.json` with vitest | Vitest | `npx vitest run` |
| `package.json` with mocha | Mocha | `npx mocha` |
| `pyproject.toml` / `pytest.ini` | pytest | `pytest` |
| `go.mod` | go test | `go test ./...` |
| `Cargo.toml` | cargo test | `cargo test` |
| `Makefile` with test target | make | `make test` |

Also detect existing test file patterns:
- `*.test.ts`, `*.spec.ts`, `__tests__/`
- `*_test.py`, `tests/`
- `*_test.go`

### Test Coverage Requirements

For each implemented task, identify:

- **Happy path** — primary use case with valid inputs
- **Edge cases** — empty, null, max, min, boundary values
- **Error conditions** — what happens on failure, invalid input, timeouts
- **Concurrency** — parallel access if applicable
- **Security** — malicious input, injection attempts, auth boundaries

## Output Format

Write to `.agents/tmp/kenken/phases/3.1-test-plan.md`:

```
# Test Plan

## Framework
{detected or configured framework}

## Test Command
{command to run tests}

## Coverage Command
{command to run coverage}

## Test Cases

### {source file or module}

#### Happy Path
- Test: {description}
  Input: {sample input}
  Expected: {expected output}

#### Edge Cases
- Test: {description}
  Input: {edge case input}
  Expected: {expected behavior}

#### Error Conditions
- Test: {description}
  Input: {invalid input}
  Expected: {error behavior}

## Coverage Target
{threshold from config, default 80%}
```
