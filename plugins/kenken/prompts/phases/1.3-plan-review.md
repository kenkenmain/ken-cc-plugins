# Phase 1.3: Plan Review [PHASE 1.3]

## Subagent Config

- **Type:** kenken:codex-reviewer (uses codex-high MCP)
- **Input:** `.agents/tmp/kenken/phases/1.2-plan.md`
- **Output:** `.agents/tmp/kenken/phases/1.3-plan-review.json`

## Instructions

Review the implementation plan using Codex MCP. Route through `kenken:codex-reviewer` agent.

### Process

1. Read `.agents/tmp/kenken/phases/1.2-plan.md`
2. Dispatch to Codex MCP (codex-high) with plan-review criteria
3. Write review result to output file

### Codex Dispatch

```
mcp__codex-high__codex(
  prompt: "Review the implementation plan at .agents/tmp/kenken/phases/1.2-plan.md. Return JSON with status, issues[], summary.",
  cwd: "{project dir}"
)
```

### Review Criteria

**HIGH — blocks approval:**

- Missing error handling for operations that can fail
- Race conditions or concurrency issues not addressed
- Security holes: injection, auth bypass, data exposure
- Data loss scenarios not mitigated
- Vague task descriptions — "implement the feature" without specifics
- No rollback strategy for failures

**MEDIUM — should fix before implementation:**

- Tasks too large to verify (>5 minutes of work)
- Missing edge cases in task specifications
- Insufficient logging for debugging
- Incorrect dependency ordering between tasks
- No input validation specified

**LOW — note for improvement:**

- Style inconsistencies with codebase conventions
- Missing documentation tasks
- Naming convention violations

### Before Approving

Verify:

- Every task has specific files and exact changes
- Every task has verification steps
- Error handling is explicit, not deferred
- No TODOs or "implement later" placeholders
- Dependencies are correct and complete
- Logging covers all key operations

## Output Format

Write Codex response as JSON to `.agents/tmp/kenken/phases/1.3-plan-review.json`:

```json
{
  "status": "approved" | "needs_revision",
  "issues": [
    {
      "severity": "HIGH" | "MEDIUM" | "LOW",
      "description": "...",
      "location": "task ID or section",
      "suggestion": "..."
    }
  ],
  "summary": "..."
}
```

### If Issues Found

If status is `needs_revision` with blocking issues:

1. Fix issues based on suggestions
2. Re-run review (increment retryCount)
3. Repeat until approved or max retries (config: `retries.maxPerPhase`)

ANY HIGH issue = requires revision. Fix everything before proceeding to implementation.
