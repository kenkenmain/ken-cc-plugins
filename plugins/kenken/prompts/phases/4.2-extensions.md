# Phase 4.2: Extensions [PHASE 4.2]

## Subagent Config

- **Type:** general-purpose (single subagent)
- **Input:** `.agents/tmp/kenken/phases/4.1-final-review.json`
- **Output:** `.agents/tmp/kenken/phases/4.2-extensions.json`

## Instructions

Analyze completed work and suggest extension tasks. This is the decision point where the workflow may loop back to PLAN or advance to completion.

### Process

1. Read final review result from `.agents/tmp/kenken/phases/4.1-final-review.json`
2. Analyze what was implemented and what natural next steps exist
3. Generate 2-3 suggested extension tasks
4. Present to user using AskUserQuestion:
   - Options: Extension 1, Extension 2, Extension 3, Done
5. Write decision to output file

### Extension Suggestions

When generating extensions, consider:

- **Natural follow-ups** — features that complement what was just built
- **Hardening** — additional error handling, edge cases, resilience
- **Performance** — optimization opportunities identified during review
- **Testing** — additional test coverage for uncovered paths
- **Documentation** — API docs, usage examples, architecture notes

Each suggestion should be:
- Self-contained (can be planned and implemented independently)
- Clearly scoped (2-5 tasks, completable in one iteration)
- Directly related to the completed work

### User Interaction

Present options via AskUserQuestion with header "Suggest Extensions":

```
The implementation is complete. Here are suggested next steps:

1. {Extension 1 title}: {brief description}
2. {Extension 2 title}: {brief description}
3. {Extension 3 title}: {brief description}
4. Done - proceed to completion

Which would you like to pursue?
```

### Decision Logic

- If user selects an extension:
  - Set `decision: "extension"`
  - Set `extensionTask` to the selected extension description
  - Queue extension — workflow loops back to Phase 1.1 (PLAN stage) with the extension as the new task
- If user selects "Done":
  - Set `decision: "done"`
  - Advance to Phase 4.3 (Completion)

## Output Format

Write to `.agents/tmp/kenken/phases/4.2-extensions.json`:

```json
{
  "decision": "extension" | "done",
  "extensionTask": "Description of selected extension task (null if done)",
  "suggestedExtensions": [
    {
      "title": "...",
      "description": "...",
      "estimatedTasks": 3,
      "scope": "..."
    }
  ],
  "userChoice": "Extension 1" | "Extension 2" | "Extension 3" | "Done"
}
```

### Loop Behavior

- `decision: "extension"` -> Update state task to `extensionTask`, reset to Phase 1.1, increment extension counter
- `decision: "done"` -> Advance to Phase 4.3
